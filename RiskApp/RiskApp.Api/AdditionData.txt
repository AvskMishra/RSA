// --- Minimal CRUD for Profile ---
app.MapPost("/api/profiles", async (ProfileCreateDto dto, IProfileService svc, CancellationToken ct) =>
{
    var created = await svc.CreateAsync(dto, ct);
    return Results.Created($"/api/profiles/{created.Id}", created);
});

app.MapGet("/api/profiles/{id:guid}", async (Guid id, IProfileService svc, CancellationToken ct) =>
{
    var found = await svc.GetAsync(id, ct);
    return found is null ? Results.NotFound() : Results.Ok(found);
});

app.MapGet("/api/profiles", async (int skip, int take, IProfileService svc, CancellationToken ct) =>
{
    var list = await svc.ListAsync(skip, take, ct);
    return Results.Ok(list);
});

app.MapPut("/api/profiles/{id:guid}", async (Guid id, ProfileUpdateDto dto, IProfileService svc, CancellationToken ct) =>
{
    var ok = await svc.UpdateAsync(id, dto, ct);
    return ok ? Results.NoContent() : Results.NotFound();
});

app.MapDelete("/api/profiles/{id:guid}", async (Guid id, IProfileService svc, CancellationToken ct) =>
{
    var ok = await svc.DeleteAsync(id, ct);
    return ok ? Results.NoContent() : Results.NotFound();
});



//migration commands
Add-Migration InitialCreate -Project RiskApp.Infrastructure -StartupProject RiskApp.Api -OutputDir Persistence\Migrations
Update-Database -Project RiskApp.Infrastructure -StartupProject RiskApp.Api